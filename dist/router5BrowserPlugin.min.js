!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.router5BrowserPlugin=t()}(this,function(){"use strict";function e(e,t){function a(e){var a=e.match(/^(?:http|https):\/\/(?:[0-9a-z_\-.:]+?)(?=\/)(.*)$/),n=(a?a[1]:e).match(/^(.+?)(#.+?)?(\?.+)?$/);if(!n)throw new Error("[router5] Could not parse url "+e);var r=n[1],o=n[2]||"",i=n[3]||"";return(t.useHash?o.replace(new RegExp("^#"+t.hashPrefix),""):t.base?r.replace(new RegExp("^"+t.base),""):r)+i}e.urlToPath=a,e.buildUrl=function(a,n){return(t.base||"")+(t.useHash?"#"+t.hashPrefix:"")+e.buildPath(a,n)},e.matchUrl=function(t){return e.matchPath(a(t))}}var t={ROUTER_NOT_STARTED:"NOT_STARTED",NO_START_PATH_OR_STATE:"NO_START_PATH_OR_STATE",ROUTER_ALREADY_STARTED:"ALREADY_STARTED",ROUTE_NOT_FOUND:"ROUTE_NOT_FOUND",SAME_STATES:"SAME_STATES",CANNOT_DEACTIVATE:"CANNOT_DEACTIVATE",CANNOT_ACTIVATE:"CANNOT_ACTIVATE",TRANSITION_ERR:"TRANSITION_ERR",TRANSITION_CANCELLED:"CANCELLED"},a={UNKNOWN_ROUTE:"@@router5/UNKNOWN_ROUTE",ROUTER_START:"$start",ROUTER_STOP:"$stop",TRANSITION_START:"$$start",TRANSITION_CANCEL:"$$cancel",TRANSITION_SUCCESS:"$$success",TRANSITION_ERROR:"$$error"},n=function(e){return function(){return e}},r=function(){},o={},i=o="undefined"!=typeof window&&window.history?{getBase:function(){return window.location.pathname.replace(/\/$/,"")},pushState:function(e,t,a){return window.history.pushState(e,t,a)},replaceState:function(e,t,a){return window.history.replaceState(e,t,a)},addPopstateListener:function(e){return window.addEventListener("popstate",e)},removePopstateListener:function(e){return window.removeEventListener("popstate",e)},getLocation:function(e){return((e.useHash?window.location.hash.replace(new RegExp("^#"+e.hashPrefix),""):window.location.pathname.replace(new RegExp("^"+e.base),""))||"/")+window.location.search},getState:function(){return window.history.state},getHash:function(){return window.location.hash}}:{getBase:n(""),pushState:r,replaceState:r,addPopstateListener:r,removePopstateListener:r,getLocation:n(""),getState:n(null),getHash:n("")},s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},u={forceDeactivate:!0,useHash:!1,hashPrefix:"",base:!1,mergeState:!1,preserveHash:!1},c="popstate";return function(){function n(n){function r(e,t,a){var n=e?{meta:e.meta,name:e.name,params:e.params,path:e.path}:e,r=!0===T.mergeState?s({},o.getState(),n):n;a?o.replaceState(r,"",t):o.pushState(r,"",t)}function i(e){var i=n.getState(),l=!e.state||!e.state.name,S=l?n.matchPath(o.getLocation(T),c):e.state,f=u.defaultRoute,h=u.defaultParams;S?i&&n.areStatesEqual(S,i,!1)||n.transitionToState(S,i,p,function(e,o){if(e)if(e.redirect){var u=e.redirect,c=u.name,T=u.params;n.navigate(c,T,s({},p,{replace:!0}))}else if(e===t.CANNOT_DEACTIVATE){var E=n.buildUrl(i.name,i.params);l||r(S,E,!0)}else f&&n.navigate(f,h,s({},p,{reload:!0,replace:!0}));else n.invokeEventListeners(a.TRANSITION_SUCCESS,o,i,{replace:!0})}):f&&n.navigateToDefault(s({},p,{reload:!0,replace:!0}))}var u=n.getOptions(),l=n.start;return e(n,T),n.start=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return 0===t.length||"function"==typeof t[0]?l.apply(void 0,[o.getLocation(T)].concat(t)):l.apply(void 0,t),n},n.replaceHistoryState=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.buildState(e,t),r=n.buildUrl(e,t);n.lastKnownState=a,o.replaceState(a,"",r)},{onStart:function(){T.useHash&&!T.base&&(T.base=o.getBase()),o.addPopstateListener(i)},onStop:function(){o.removePopstateListener(i)},onTransitionSuccess:function(e,t,a){var i=o.getState(),s=a.replace||t&&n.areStatesEqual(e,t,!1)||a.reload&&i&&n.areStatesEqual(e,i,!1),u=n.buildUrl(e.name,e.params);null===t&&!0===T.preserveHash&&(u+=o.getHash()),r(e,u,s)},onPopState:i}}var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,T=s({},u,r),p={forceDeactivate:T.forceDeactivate,source:c};return n.pluginName="BROWSER_PLUGIN",n}});
